{"ast":null,"code":"import{makeAutoObservable}from'mobx';import AuthService from\"../services/AuthService\";import axios from\"axios\";import{API_URL}from\"../http\";import{jwtDecode}from\"jwt-decode\";export default class Store{constructor(){this.user={};this.isAuth=false;makeAutoObservable(this);}setAuth(bool){this.isAuth=bool;}setUser(user){this.user=user;}async login(email,password,role){try{const response=await AuthService.login(email,password,role);const token=response.data.accessToken;localStorage.setItem('token',token);this.setAuth(true);this.setUser(response.data.user);return jwtDecode(token);}catch(e){var _e$response,_e$response$data;console.error(\"Login Error:\",e);const errorMessage=((_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.message)||'Помилка авторизації';alert(errorMessage);}}async registration(name,email,password,role){try{const response=await AuthService.registration(name,email,password,role);const token=response.data.accessToken;localStorage.setItem('token',token);this.setAuth(true);this.setUser(response.data.user);return jwtDecode(token);}catch(e){var _e$response2,_e$response2$data;console.error(\"Registration Error:\",e);const errorMessage=((_e$response2=e.response)===null||_e$response2===void 0?void 0:(_e$response2$data=_e$response2.data)===null||_e$response2$data===void 0?void 0:_e$response2$data.message)||'Помилка реєстрації';alert(errorMessage);}}async loguot(){try{await AuthService.loguot();localStorage.removeItem('token');this.setAuth(false);this.setUser({});}catch(e){var _e$response3,_e$response3$data;console.log((_e$response3=e.response)===null||_e$response3===void 0?void 0:(_e$response3$data=_e$response3.data)===null||_e$response3$data===void 0?void 0:_e$response3$data.message);}}async checkAuth(){try{const response=await axios.get(\"\".concat(API_URL,\"/refresh\"),{withCredentials:true});localStorage.setItem('token',response.data.accessToken);this.setAuth(true);this.setUser(response.data.user);}catch(e){var _e$response4,_e$response4$data;console.log((_e$response4=e.response)===null||_e$response4===void 0?void 0:(_e$response4$data=_e$response4.data)===null||_e$response4$data===void 0?void 0:_e$response4$data.message);}}}","map":{"version":3,"names":["makeAutoObservable","AuthService","axios","API_URL","jwtDecode","Store","constructor","user","isAuth","setAuth","bool","setUser","login","email","password","role","response","token","data","accessToken","localStorage","setItem","e","_e$response","_e$response$data","console","error","errorMessage","message","alert","registration","name","_e$response2","_e$response2$data","loguot","removeItem","_e$response3","_e$response3$data","log","checkAuth","get","concat","withCredentials","_e$response4","_e$response4$data"],"sources":["/Users/mac/analytix/client/src/store/store.ts"],"sourcesContent":["import { IUserLogin, IUserRegist } from '../models/IUser';\nimport {makeAutoObservable} from 'mobx';\nimport AuthService from \"../services/AuthService\";\nimport axios from \"axios\";\nimport { API_URL } from \"../http\";\nimport { AuthResponseLogin } from \"../models/response/AuthResponse\";\nimport { jwtDecode } from \"jwt-decode\";\n\n\nexport default class Store {\n  user = {} as IUserRegist | IUserLogin;\n  isAuth = false;\n\n  constructor() {\n    makeAutoObservable(this);\n  }\n\n  setAuth(bool: boolean) {\n    this.isAuth = bool;\n  }\n\n  setUser(user: IUserRegist | IUserLogin) {\n    this.user = user;\n  }\n\n\n  async login(email: string, password: string, role: string) {\n    try {\n      const response = await AuthService.login(email, password, role);\n      const token = response.data.accessToken\n      localStorage.setItem('token', token);\n      this.setAuth(true);\n      this.setUser(response.data.user);\n      return jwtDecode(token);\n      \n    } catch (e: any) {\n      console.error(\"Login Error:\", e);\n      const errorMessage = e.response?.data?.message || 'Помилка авторизації';\n      alert(errorMessage);\n  }\n  }\n\n  async registration(name: string, email: string, password: string, role: string) { \n    try {\n      const response = await AuthService.registration(name, email, password, role);\n      const token = response.data.accessToken\n      localStorage.setItem('token', token);\n      this.setAuth(true);\n      this.setUser(response.data.user);\n      return jwtDecode(token);\n      \n    } catch (e: any) {\n      console.error(\"Registration Error:\", e);\n      const errorMessage = e.response?.data?.message || 'Помилка реєстрації';\n      alert(errorMessage);\n  }\n  }\n\n  async loguot() {\n    try {\n      await AuthService.loguot();\n      localStorage.removeItem('token');\n      this.setAuth(false);\n      this.setUser({} as IUserLogin | IUserRegist);\n      \n    } catch (e: any) {\n      console.log(e.response?.data?.message)\n    }\n  }\n\n  async checkAuth() {\n    try {\n      const response = await axios.get<AuthResponseLogin>(`${API_URL}/refresh`, {withCredentials: true});\n      localStorage.setItem('token', response.data.accessToken);\n      this.setAuth(true);\n      this.setUser(response.data.user);\n    } catch (e: any) {\n      console.log(e.response?.data?.message)\n    }\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}